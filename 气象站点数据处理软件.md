# 气象站点数据处理软件

## 安装MySQL数据库

[参考链接](https://github.com/monarch-beluga/Study-notes/blob/master/mysql/Mysql%E4%BD%BF%E7%94%A8/01_MySql%E5%88%9D%E5%A7%8B.md)

## 安装气象站点数据处理软件

软件是基于ArcGIS10.2的二次开发，所以安装软件之前先安装引擎（MAPS）

如果已经安装ArcGIS10.2则不用安装ArcGIS License Administrator及破解

![2021-08-26_011047](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826011101422-933960678.png)

打开ArcGIS Administrator，启动ArcEngine服务

![2021-08-26_011207](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826011230119-458232783.png)

![2021-08-26_011217](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826011239128-131387824.png)

安装MPIS

注意：==不要安装在默认路径==，可以安装在C盘根目录或者其他盘

![2021-08-26_011325](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826011357268-680151172.png)

### 重要存储文件地址介绍

MPIS安装路径 -> dataBase -> dBase ：数据库存储位置，总共两个（国内和国外）

MPIS安装路径 -> dataBase -> meteoName : 可以存储的气象数据类型

MPIS安装路径 -> dataBase -> TotalStation ： 生成的总站点文件

MPIS安装路径 -> TempStore -> Buffer : 生成的缓冲区文件

MPIS安装路径 -> TempStore -> Stations ：生成的站点文件

## 气象数据入库

### 数据库配置和初始化

测试并保存MPIS和MySQL的链接

![2021-08-27_223624](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210827223657240-1649496287.png)

数据库初始化（初始化后可以在SQLyog中看见新添加的两个数据库）

![2021-08-27_223710](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210827223716893-1793248212.png)

### 站点数据

站点数据导入

![2021-08-27_223904](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210827223922638-1498502523.png)

站点数据查询

![2021-08-24_202011](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210824202026830-1604768640.png)

站点数据清空

清空所选数据库中的站点数据记录

### 气象数据

创建气象数据表，用于存储不同年份的气象数据。先建表后导入气象数据，表的名称为all+输入的年份（示例：all2019）

![2021-08-24_224044](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210824224132608-928349903.png)

导入气象数据，选择对应的数据库和数据文件以及对应的年份。

数据以==逗号==为分隔符，共19列，分别是台站、年、月、日、平均本站气压、日最高本站气压、日最低本站气压、平均气温、日最高气温、日最低气温、平均相对湿度、最小相对湿度、降水量、平均风速、最大风速、最大风速的风向、极大风速、极大风速的风向、日照时数。数据库中还有最后两列为==自动生成==。

![2021-08-26_003502](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826003528713-2136752078.png)

![2021-08-27_224058](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210827224119469-76422044.png)

查询气象数据：输入站点、年份和选择数据库

![2021-08-26_104712](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826104803716-2006081266.png)

清空数据表记录

只会清空数据表中的数据，==不会删除表==

## 气象数据处理和插值

### 站点信息生成/更新

从数据库中检索气象站点信息并生成矢量文件(*.shp格式)。先生成国内站点文件，然后合并国内和国外站点（自带空白文件）信息生成总站点文件。

![2021-09-04_081458](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904081516133-924548246.png)

生成总站点文件后，加载所有站点即可显示在图形化界面

![2021-09-04_081546](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904081600844-1740537689.png)

### 缓冲区/按矢量选取

打开工具箱，导入面要素

![2021-08-26_010137](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826010152648-2044579363.png)

对面要素生成缓冲区，载入最后一次生成的缓冲区文件

![2021-08-26_005930](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826010227017-1686480933.png)

按矢量选取站点，使用生成的缓冲区或者输入矢量边界文件，加载最后一次生成的站点文件即可显示在图形化界面。

![2021-09-04_082615](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904082805248-653815272.png)

### 检查和处理

==此处的处理都是为了后续的插值==

加载数据并写入内存。选择要加载的文件或者最后一次选择的站点文件 -> 设置要插值的气象条件 -> 选择时间范围。

![2021-09-04_083805](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904083819813-2087663590.png)

过滤数据，如果站点的有效值小于90%（可改）则删除。

![2021-08-26_000828](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826000910421-1240796510.png)

处理无效值暂时不可用

### 数据插值

在已经加载、过滤数据并写入内存的情况下，可以对写入内存的数据进行日（或月、年）尺度求平均或总和

==“仅用作数据输出，不进行插值操作”选项还存在问题，暂时不要勾选==

![2021-09-04_084153](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904084204853-1028234479.png)

当进行月或年尺度插值时会有以下提醒

![2021-08-25_231656](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826002230024-745800397.png)

在已经进行插值尺度计算后进行栅格数据插值

注意：==年尺度处理后的数据暂时不支持插值==

数据插值:IDW方法

==输入的栅格数据必须包含所选的所有站点==

![2021-08-26_002929](https://img2020.cnblogs.com/blog/2516747/202108/2516747-20210826002940916-1841829197.png)

数据插值：Anusplin方法

需要将要输入的文件放在==同一个文件夹==，输入的文件包括处理后的dat文件和ASCII码格式的文件（可以在arcgis中使用工具—栅格转ASCII），然后把asc后缀改为txt后缀

Splina

![2021-09-04_090915](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904090930984-264234198.png)

生成lapgrd.cmd文件。需要指定输出文件夹（自己先新建），建在上面输入的文件目录下。

![2021-09-04_091013](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904091020797-83510303.png)

运行两步

![2021-09-04_093801](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904093814246-1608957481.png)

Splinb

![2021-09-04_091130](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904091136486-2000182753.png)

![2021-09-04_091213](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904091228933-659658831.png)

运行三步

![2021-09-04_091314](https://img2020.cnblogs.com/blog/2516747/202109/2516747-20210904091321932-1397516679.png)
